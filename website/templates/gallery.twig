{% extends "base.twig" %}

{% block header %}
<script type='text/javascript' src='http://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.4.0/fabric.min.js'></script>

 <script type='text/javascript'>
     window.onload=function(){
 {% for image in userimages %}
    var canvas = new fabric.Canvas('galleryImage{{ loop.index }}');
    var group = new fabric.Group();
    canvas.add(group);
/*    TODO: hier stimmt was nicht ... die loops sind glaube ich nicht n√∂tig. Mit 7 testen*/
    var obj = JSON.parse('{{ image.image|raw}}');
    for (var line in obj) {
        var lastPoint = undefined;
        for (var point in obj[line]) {
            var path = new fabric.Path('{{ image.path}}');
            path.set({fill: 'transparent', stroke: 'red', strokeWidth: 3});
            path.scale(Math.min(canvas.height / path.height, 
                                        canvas.width  / path.width));
            canvas.add(path);
        }
    }

    canvas.renderAll();
    path.center();
    {% endfor %}
}
 </script>
{% endblock %}

{% block content %}
   <ul class="gallery mw-gallery-traditional">
    {% for image in userimages %}
     <li class="gallerybox" style="width: 155px">
       <div style="width: 155px">
         <div class="thumb" style="width: 150px;">
           <div style="margin:21px auto;">
             <canvas id="galleryImage{{ loop.index }}" class="gallerycanvas" width="140" height="140">
             </canvas>
           </div>
         </div>
         <div class="gallerytext"><a href="../view?id={{ image.id }}">{{ image.creation_date }}</a></div>
       </div>
     </li>
    {% endfor %}
   </ul>
{% endblock %}