{% extends "base.twig" %}

{% block header %}
<script type='text/javascript' src='http://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.4.0/fabric.min.js'></script>

 <script type='text/javascript'>
     window.onload=function(){
    var canvas = new fabric.StaticCanvas('galleryImage');
    var group = new fabric.Group();
    canvas.add(group);

    var path = new fabric.Path('{{ image.path }}');
    path.set({fill: 'transparent', stroke: 'red', strokeWidth: 3});
    canvas.add(path);

    {% if show_points %}
    var group = new fabric.Group([], {});
    var point_array = {{ points|raw }};
    point_array.forEach(function(entry) {
        circle = new fabric.Circle({
            radius: 3, fill: 'green', left: entry['x'], top: entry['y']
        });
        group.addWithUpdate(circle);
    });
    canvas.add(group);
    {% endif %}


    canvas.renderAll();
    path.center();
    group.center();
    /* Make sure that touch events do nothing */
    canvas.deactivateAll();
    canvas.selection = false;
    canvas.forEachObject(function(o) {
        o.selectable = false;
    });
}
 </script>
{% endblock %}

{% block content %}
<div class="row-fluid clearfix">
    <div class="span6 pull-left panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">Modified image</h3>
        </div>
        <div class="panel-body"><canvas id="galleryImage" width="400" height="400"></canvas></div>
    </div>
    <div class="span6 pull-right panel panel-default" style="width:400px;">
        <div class="panel-heading" style="padding-left:50px;">
            <h3 class="panel-title">Preprocessing options</h3>
        </div>
        <div class="panel-body" style="margin-left:50px;">
<form role="form" method="get" onsubmit="$('button').prop('disabled', true);">
  <div class="form-group">
    <label for="raw_data_id">Raw data id</label>
    <input type="number"
           class="form-control"
           id="raw_data_id" name="raw_data_id"
           placeholder="31"
           value="{{ image.id }}" />
  </div>
  <div class="checkbox">
    <label>
      <input type="checkbox"
             name="show_points"
             {% if show_points %}checked="checked"{% endif %}
             /> Show points
    </label>
  </div>
  <div class="checkbox">
    <label>
      <input type="checkbox"
             name="scale_and_shift"
             {% if scale_and_shift %}checked="checked"{% endif %}
             /> Scale and shift
        <p class="help-block">Shift points in space and time, but scale them only in space</p>
    </label>
  </div>
  <div class="checkbox">
    <label>
      <input type="checkbox"
             name="douglas_peucker"
             {% if douglas_peucker %}checked="checked"{% endif %}
             /> Douglas Peucker <input type="text" name="epsilon" value="{{epsilon}}"/>
        <p class="help-block">Apply the Douglas-Peucker algorithm to get
        rid of points that seem to be not much different from other points</p>
    </label>
  </div>
  <div class="checkbox">
    <label>
      <input type="checkbox"
             name="cubic_spline"
             {% if cubic_spline %}checked="checked"{% endif %}
             /> Cubic spline <input type="number" name="cubic_spline_points" min="2" max="100"
             step="1" value="{{cubic_spline_points}}"/>
        <p class="help-block">Space points equidistant in time</p>
    </label>
  </div>
  <button type="submit" class="btn btn-primary">Submit</button>
</form>
        </div>
    </div>
</div>


    <h2>Raw data</h2>
    <pre>{{ image.data }}</pre>
    <p>See <a href="../view?raw_data_id={{ image.id }}">raw data information</a></p>
{% endblock %}